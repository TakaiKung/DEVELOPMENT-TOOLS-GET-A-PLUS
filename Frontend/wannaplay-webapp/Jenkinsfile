pipeline {
     agent any
stages {
    stage('Pull code') {
        steps {
            checkout scm
        }
    }
    stage('Download dependency') {
        steps {
            dir('Frontend/wannaplay-webapp') {
                sh 'npm install'
            }
        }
    }
    stage('Run unit test') {
         steps {
               dir('Frontend/wannaplay-webapp') {
                    sh 'docker-compose'
                    sh 'npm run test'
               }
         }
    }
    stage('Run Integration test') {
        steps {
            echo 'run component test'
        }
    }
    stage('Build') {
        steps {
            
           dir('Frontend/wannaplay-webapp') {
                sh 'npm run-script build'
            }
        }
    }
     stage('buildimage') {
      steps {
            echo 'buildimage'
            dir('Frontend/wannaplay-webapp') {
                sh 'docker image build devtool09/team-9-frontend:1.0.2'
                 withCredentials([string(credentialsId: 'T09_PASSWORD', variable: 'T09_PASSWORD')]) {
                     sh 'docker login'
                     sh $T09_PASSWORD
                     sh $T09_PASSWORD
                    }
                sh 'docker push devtool09/team-9-frontend:1.0.2'
            }
        }
    }
     
    stage('Deployment') {
      steps {
            dir('Frontend/wannaplay-webapp') {
                withCredentials([string(credentialsId: 'T09_FRONTEND_USERNAME', variable: 'T09_USERNAME')]) {
                   sh 'ssh $T09_USERNAME'
               }
               withCredentials([string(credentialsId: 'T09_FRONTEND_PASS', variable: 'T09_PASS')]) {
                    sh $T09_PASS
               }
               
                 sh 'docker pull devtool09/team-9-frontend:1.0.2'
                 sh 'docker container run -d -p 9989:3000 devtool09/team-9-frontend:1.0.2'
            }
        }
    }
     
  }
}
